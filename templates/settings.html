<!DOCTYPE html>
<html class="">
  <head>
    <title>Vault Analyzer - Settings</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      window.FontAwesomeConfig = { autoReplaceSvg: "nest" };
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
     <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ°Ô∏è</text></svg>">
     <style>
      * { font-family: "Inter", sans-serif; }
      ::-webkit-scrollbar { display: none; }
       :root {
        --color-base-50: #f8fafc; --color-base-100: #f1f5f9; --color-base-200: #e2e8f0; --color-base-300: #cbd5e1; --color-base-400: #94a3b8; --color-base-500: #64748b; --color-base-600: #475569; --color-base-700: #334155; --color-base-800: #1e293b; --color-base-900: #0f172a; --color-base-content: #0f172a; --color-border-base: #e2e8f0;
        --color-primary: #3b82f6; --color-primary-50: #eff6ff; --color-primary-100: #dbeafe; --color-primary-300: #93c5fd; --color-primary-500: #3b82f6; --color-primary-600: #2563eb; --color-primary-700: #1d4ed8; --color-primary-content: #ffffff;
        --color-error-50: #fef2f2; --color-error-300: #fca5a5; --color-error-700: #b91c1c;
        --color-success-50: #ecfdf5; --color-success-300: #6ee7b7; --color-success-700: #047857;
        --color-info-50: var(--color-primary-50); --color-info-300: var(--color-primary-300); --color-info-700: var(--color-primary-700);
       }
       .dark {
         --color-base-50: #1e293b; --color-base-100: #0f172a; --color-base-200: #1e293b; --color-base-300: #334155; --color-base-400: #475569; --color-base-500: #64748b; --color-base-600: #94a3b8; --color-base-700: #cbd5e1; --color-base-800: #e2e8f0; --color-base-900: #f1f5f9; --color-base-content: #e2e8f0; --color-border-base: #334155;
         --color-error-50: rgba(185, 28, 28, 0.2); --color-error-300: #fca5a5; --color-error-700: #f87171;
         --color-success-50: rgba(4, 120, 87, 0.2); --color-success-300: #a7f3d0; --color-success-700: #34d399;
         --color-info-50: rgba(29, 78, 216, 0.2); --color-info-300: #93c5fd; --color-info-700: #bfdbfe;
       }
       .sidebar-link.active { background-color: var(--color-primary-100); color: var(--color-primary-700); font-weight: 600; }
       .dark .sidebar-link.active { background-color: var(--color-base-700); color: var(--color-primary-300); }
    </style>
      <script>
      tailwind.config = {
        darkMode: 'class',
        theme: { extend: { colors: {
              transparent:"transparent", current:"currentColor", black:"#000000", white:"#ffffff",
              gray:{300:"#d1d5db", 400:"#9ca3af", 500:"#6b7280", 600:"#475569", 700:"#334155"},
              slate:{700:"#334155", 800:"#1e293b"},
              red:{50:"var(--color-error-50)", 300:"var(--color-error-300)", 700:"var(--color-error-700)"},
              green:{50:"var(--color-success-50)", 300:"var(--color-success-300)", 700:"var(--color-success-700)"},
              blue:{50:"var(--color-info-50)", 300:"var(--color-info-300)", 700:"var(--color-info-700)"},
              indigo:{500:"#6366f1"},
              primary: { DEFAULT:"var(--color-primary)", content:"var(--color-primary-content)", 100:"var(--color-primary-100)", 500:"var(--color-primary-500)", 600:"var(--color-primary-600)", 700:"var(--color-primary-700)", 300:"var(--color-primary-300)" },
              base: { 50:"var(--color-base-50)", 100:"var(--color-base-100)", 200:"var(--color-base-200)", 300:"var(--color-base-300)", 400:"var(--color-base-400)", 500:"var(--color-base-500)", 600:"var(--color-base-600)", 700:"var(--color-base-700)", 800:"var(--color-base-800)", 900:"var(--color-base-900)", DEFAULT:"var(--color-base)", content:"var(--color-base-content)" },
              'border-base': 'var(--color-border-base)'
        } } }, variants: { extend: {} },
        plugins: [
            require('@tailwindcss/forms'),
        ]
      };
    </script>
  </head>
  <body class="h-full bg-base-50 text-base-content">
     <div class="min-h-screen">
        <header id="header" class="bg-slate-800 text-white px-6 py-4 fixed w-full z-50">
           <div class="flex items-center justify-between">
              <div class="flex items-center space-x-4">
                <a href="{{ url_for('index') }}" class="text-2xl font-bold">Vault Analyzer</a>
              </div>
              <div class="flex items-center space-x-6">
                 <button id="darkModeToggle" class="text-xl"> <i class="fa-solid fa-moon"></i> </button>
                <div class="flex items-center space-x-2 relative">
                  <i class="fa-regular fa-bell text-xl cursor-pointer"></i>
                  <span class="bg-red-500 text-xs rounded-full h-5 w-5 flex items-center justify-center absolute -top-2 -right-2">3</span>
                </div>
                <div class="flex items-center space-x-3 cursor-pointer">
                  <img src="https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-2.jpg" alt="User Avatar" class="w-10 h-10 rounded-full border-2 border-gray-300">
                  <span class="hidden sm:inline">User</span>
                  <i class="fa-solid fa-chevron-down text-xs"></i>
                </div>
              </div>
            </div>
        </header>

        <div class="flex pt-[72px]">
             <aside id="sidebar" class="w-64 bg-base-100 h-[calc(100vh-72px)] fixed border-r border-border-base overflow-y-auto">
                 <nav class="p-4">
                    <div class="space-y-6">
                        <div id="main-nav" class="space-y-2">
                            <a href="{{ url_for('index') }}" class="sidebar-link flex items-center space-x-3 px-4 py-3 text-base-600 hover:bg-base-200 hover:text-base-900 rounded-lg {% if request.endpoint == 'index' %} active {% endif %}">
                                <i class="fa-solid fa-chart-line fa-fw"></i>
                                <span>Dashboard</span>
                            </a>
                            <a href="#" class="flex items-center space-x-3 px-4 py-3 text-base-400 cursor-not-allowed rounded-lg">
                                <i class="fa-solid fa-file-waveform fa-fw"></i>
                                <span>Current Report</span>
                            </a>
                            <a href="{{ url_for('history') }}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg text-base-600 hover:bg-base-200 hover:text-base-900 {% if request.endpoint == 'history' %} active {% endif %}">
                                <i class="fa-solid fa-history fa-fw"></i>
                                <span>History</span>
                            </a>
                        </div>
                         <div id="tools-nav" class="pt-6 border-t border-border-base">
                             <h3 class="px-4 text-xs font-semibold text-base-500 uppercase tracking-wider">Tools</h3>
                             <div class="mt-4 space-y-2">
                                <a href="{{ url_for('settings') }}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg text-base-600 hover:bg-base-200 hover:text-base-900 {% if request.endpoint == 'settings' %} active {% endif %}">
                                    <i class="fa-solid fa-gear fa-fw"></i>
                                    <span>Settings</span>
                                </a>
                             </div>
                        </div>
                     </div>
                 </nav>
            </aside>

            <main id="main-content" class="flex-1 ml-64 p-6 bg-base-50 overflow-y-auto">
                 {% with messages = get_flashed_messages(with_categories=true) %}
                 {% if messages %}
                 <div class="mb-4 space-y-2 flash-container">
                   {% for category, message in messages %}
                   <div class="p-4 rounded-md border {% if category == 'error' %}bg-error-50 border-error-300 text-error-700{% elif category == 'success' %}bg-success-50 border-success-300 text-success-700{% elif category == 'warning' %}bg-warning-50 border-warning-300 text-warning-700 dark:text-warning-content{% else %}bg-info-50 border-info-300 text-info-700{% endif %}" role="alert">
                     <strong class="font-bold capitalize">{{ category }}!</strong> {{ message }}
                   </div>
                   {% endfor %}
                 </div>
                 {% endif %}
                 {% endwith %}

                 <div id="page-header" class="mb-6 border-b border-border-base pb-4">
                    <h2 class="text-2xl font-bold text-base-content">Settings</h2>
                    <p class="text-base-600 mt-1 text-sm">Configure analysis options.</p>
                 </div>

                 <div class="bg-base-100 rounded-lg shadow-sm p-6">
                     <form action="{{ url_for('settings') }}" method="POST">
                         <div class="space-y-6">
                            <div>
                                <label for="password_age_years" class="block text-sm font-medium text-base-700">Password Age Threshold (Years)</label>
                                <select id="password_age_years" name="password_age_years" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-base-300 bg-base-100 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                     <option value="0" {% if settings.password_age_years == 0 %}selected{% endif %}>Disabled</option>
                                     <option value="1" {% if settings.password_age_years == 1 %}selected{% endif %}>1 Year</option>
                                     <option value="2" {% if settings.password_age_years == 2 %}selected{% endif %}>2 Years</option>
                                     <option value="3" {% if settings.password_age_years == 3 %}selected{% endif %}>3 Years</option>
                                     <option value="5" {% if settings.password_age_years == 5 %}selected{% endif %}>5 Years</option>
                                 </select>
                                 <p class="mt-1 text-xs text-base-500">Flag passwords older than this duration.</p>
                            </div>

                            <div class="relative flex items-start">
                                <div class="flex items-center h-5">
                                  <input id="check_hibp" name="check_hibp" type="checkbox" {% if settings.check_hibp %}checked{% endif %} class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-base-300 rounded bg-base-100">
                                </div>
                                <div class="ml-3 text-sm">
                                  <label for="check_hibp" class="font-medium text-base-700">Check Pwned Passwords (HIBP)</label>
                                  <p class="text-xs text-base-500">Check passwords against Have I Been Pwned database (sends hash prefixes).</p>
                                </div>
                            </div>

                             <div class="relative flex items-start">
                                <div class="flex items-center h-5">
                                  <input id="analyze_notes_fields" name="analyze_notes_fields" type="checkbox" {% if settings.analyze_notes_fields %}checked{% endif %} class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-base-300 rounded bg-base-100">
                                </div>
                                <div class="ml-3 text-sm">
                                  <label for="analyze_notes_fields" class="font-medium text-base-700">Analyze Notes & Custom Fields</label>
                                  <p class="text-xs text-base-500">Scan secure notes and custom fields for potential secrets (may increase analysis time).</p>
                                </div>
                            </div>

                             <div>
                                <label for="common_passwords_file" class="block text-sm font-medium text-base-700">Custom Common Passwords File (Optional)</label>
                                <input type="text" name="common_passwords_file" id="common_passwords_file" value="{{ settings.common_passwords_file or '' }}" class="mt-1 block w-full shadow-sm sm:text-sm border-base-300 rounded-md bg-base-100 focus:ring-indigo-500 focus:border-indigo-500" placeholder="/path/to/your/passwords.txt">
                                <p class="mt-1 text-xs text-base-500">Path to a local file containing one common password per line (used in addition to defaults).</p>
                           </div>

                         </div>

                         <div class="pt-5 mt-5 border-t border-border-base">
                            <div class="flex justify-end">
                              <button type="submit" class="ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-primary-content bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 focus:ring-offset-base-100">
                                Save Settings
                              </button>
                            </div>
                         </div>
                     </form>
                 </div>

            </main>
        </div>
     </div>
      <script>
        document.addEventListener('DOMContentLoaded', function () {
            const darkModeToggle = document.getElementById('darkModeToggle');
            const htmlElement = document.documentElement;
             const applyTheme = () => {
                const isDark = localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
                htmlElement.classList.toggle('dark', isDark);
                darkModeToggle.innerHTML = isDark ? '<i class="fa-solid fa-sun"></i>' : '<i class="fa-solid fa-moon"></i>';
            };
             darkModeToggle.addEventListener('click', () => {
                const isDark = htmlElement.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                applyTheme();
            });
            applyTheme();
        });
     </script>
  </body>
</html>